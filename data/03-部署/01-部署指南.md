# 部署指南

AOG Notes 可以部署到任何支持 Node.js 的平台。本文介绍几种常见的部署方式。

## 构建项目

在部署之前，先构建生产版本：

```bash
npm run build
```

构建完成后，可以使用以下命令在本地预览：

```bash
npm run start
```

## Vercel 部署（推荐）

Vercel 是 Next.js 官方推荐的部署平台，提供免费额度。

### 步骤

1. Fork 本仓库到你的 GitHub 账号
2. 修改 `site.config.ts` 配置文件（网站名称、URL、描述等）
3. 访问 [vercel.com](https://vercel.com) 并使用 GitHub 登录
4. 点击 "New Project"
5. 导入你 Fork 的仓库
6. 点击 "Deploy" 等待部署完成

Vercel 会自动检测 Next.js 项目并完成部署。后续每次推送代码都会自动重新部署。

### 自定义域名

在 Vercel 项目设置中，进入 "Domains" 页面添加自定义域名。

## GitHub Pages 部署

GitHub Pages 提供免费的静态网站托管。

### 步骤

1. Fork 本仓库到你的 GitHub 账号
2. 修改 `site.config.ts` 配置文件
3. 在 `next.config.ts` 中添加静态导出配置：

```typescript
const nextConfig = {
  output: 'export',
  // 如果部署到子路径，需要配置 basePath
  // basePath: '/aog-notes',
}
```

4. 创建 `.github/workflows/deploy.yml` 文件：

```yaml
name: Deploy to GitHub Pages

on:
  push:
    branches: [main]

permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
      - run: npm ci
      - run: npm run build
      - uses: actions/upload-pages-artifact@v3
        with:
          path: ./out

  deploy:
    needs: build
    runs-on: ubuntu-latest
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    steps:
      - uses: actions/deploy-pages@v4
        id: deployment
```

5. 进入仓库 Settings > Pages，Source 选择 "GitHub Actions"
6. 推送代码后会自动部署

### 注意事项

- GitHub Pages 只支持静态网站，需要配置 `output: 'export'`
- 如果部署到 `username.github.io/repo-name`，需要配置 `basePath`

## 静态导出

如果不需要服务端功能，可以导出为纯静态网站部署到任意托管服务。

### 配置

在 `next.config.ts` 中添加：

```typescript
const nextConfig = {
  output: 'export',
}
```

### 导出

```bash
npm run build
```

构建完成后，`out/` 目录包含所有静态文件。

### 支持的托管平台

- Cloudflare Pages
- Netlify
- 阿里云 OSS
- 腾讯云 COS
- 七牛云

## 环境变量

生产环境中，建议通过环境变量配置敏感信息：

```bash
# .env.production
NEXT_PUBLIC_SITE_URL=https://your-domain.com
```

## 性能优化

部署后建议检查以下优化项：

1. 启用 CDN 加速静态资源
2. 配置合适的缓存策略
3. 启用 Gzip/Brotli 压缩
4. 使用 HTTPS
