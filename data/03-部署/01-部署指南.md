# 部署指南

AOG Notes 支持多种部署方式，包括 Vercel、GitHub Pages 和其他静态托管平台。

## 构建项目

在部署之前，先构建生产版本：

```bash
npm run build
```

构建完成后，可以使用以下命令在本地预览：

```bash
npm run start
```

## Vercel 部署（推荐）

Vercel 是 Next.js 官方推荐的部署平台，提供免费额度，部署最简单。

### 步骤

1. Fork 本仓库到你的 GitHub 账号
2. 修改 `site.config.ts` 配置文件（网站名称、URL、描述等）
3. 访问 [vercel.com](https://vercel.com) 并使用 GitHub 登录
4. 点击 "New Project"
5. 导入你 Fork 的仓库
6. 点击 "Deploy" 等待部署完成

Vercel 会自动检测 Next.js 项目并完成部署。后续每次推送代码都会自动重新部署。

### 自定义域名

在 Vercel 项目设置中，进入 "Domains" 页面添加自定义域名。

### 子路径部署

如果需要部署到子路径（如 `https://example.com/docs`），在 `site.config.ts` 中配置：

```typescript
url_config: {
  basePath: '/docs',
}
```

## GitHub Pages 部署

GitHub Pages 提供免费的静态网站托管，适合个人项目。

### 自动配置（推荐）

本项目已内置 GitHub Actions 工作流，会自动：
- 检测仓库名并设置正确的 basePath
- 构建静态网站
- 部署到 GitHub Pages

### 步骤

1. Fork 本仓库到你的 GitHub 账号
2. 修改 `site.config.ts` 配置文件
3. 进入仓库 Settings > Pages
4. Source 选择 "GitHub Actions"
5. 推送代码后会自动部署

### basePath 自动检测

部署到 GitHub Pages 时，basePath 会自动从仓库名获取：
- 仓库 `username/my-notes` → basePath 为 `/my-notes`
- 仓库 `username/username.github.io` → basePath 为空（根路径）

如需禁用自动检测，在 `site.config.ts` 中设置：

```typescript
deploy: {
  githubPagesAutoBasePath: false,
}
```

### 手动指定 basePath

如果需要手动指定 basePath，可以通过环境变量覆盖：

```yaml
# .github/workflows/deploy.yml
- name: Build
  run: npm run build
  env:
    GITHUB_PAGES: 'true'
    NEXT_PUBLIC_BASE_PATH: '/custom-path'
```

## 静态导出

如果不需要服务端功能，可以导出为纯静态网站部署到任意托管服务。

### 配置

设置环境变量 `GITHUB_PAGES=true` 或在 `next.config.ts` 中添加：

```typescript
const nextConfig = {
  output: 'export',
}
```

### 导出

```bash
npm run build
```

构建完成后，`out/` 目录包含所有静态文件。

### 支持的托管平台

- Cloudflare Pages
- Netlify
- 阿里云 OSS
- 腾讯云 COS
- 七牛云

## 环境变量

| 变量名 | 说明 | 示例 |
|--------|------|------|
| `GITHUB_PAGES` | 启用静态导出模式 | `true` |
| `GITHUB_REPOSITORY` | GitHub 仓库名（自动设置） | `owner/repo` |
| `NEXT_PUBLIC_BASE_PATH` | 手动指定 basePath | `/docs` |

### 优先级

basePath 的确定优先级：
1. `NEXT_PUBLIC_BASE_PATH` 环境变量（最高优先级）
2. GitHub Pages 自动检测（从 `GITHUB_REPOSITORY` 获取）
3. `site.config.ts` 中的 `url_config.basePath`

## 性能优化

部署后建议检查以下优化项：

1. 启用 CDN 加速静态资源
2. 配置合适的缓存策略
3. 启用 Gzip/Brotli 压缩
4. 使用 HTTPS

## 常见问题

### 资源 404

检查 basePath 配置是否正确。GitHub Pages 部署时应自动设置，如果仍有问题，尝试手动指定 `NEXT_PUBLIC_BASE_PATH`。

### 页面刷新 404

静态导出的 SPA 应用刷新时可能 404，本项目已通过复制 `index.html` 到 `404.html` 解决。

### 图片不显示

GitHub Pages 静态导出时图片优化已自动禁用。如果仍有问题，检查图片路径是否包含正确的 basePath。
