# 搜索引擎

AOG Notes 内置了一个高性能的全文搜索引擎，支持中文分词和模糊匹配。

## 工作原理

搜索引擎基于 BM25 算法实现，这是一种经典的信息检索算法，被广泛应用于搜索引擎中。

### BM25 算法

BM25 (Best Matching 25) 通过以下因素计算文档相关性：

- **词频 (TF)** - 关键词在文档中出现的次数
- **逆文档频率 (IDF)** - 关键词的稀有程度
- **文档长度** - 较短文档中的匹配权重更高

### 核心参数

```typescript
const BM25_K1 = 1.5  // 词频饱和参数
const BM25_B = 0.5   // 文档长度归一化参数
```

## 中文分词

搜索引擎使用 N-gram 方式处理中文：

```typescript
function tokenize(text: string): string[] {
  // 提取英文单词
  const englishWords = text.match(/[a-z][a-z0-9]*/g) || []
  
  // 中文 N-gram (1-3 字)
  const chineseNgrams = []
  for (let i = 0; i < text.length; i++) {
    chineseNgrams.push(text[i])           // 单字
    chineseNgrams.push(text.slice(i, i+2)) // 双字
    chineseNgrams.push(text.slice(i, i+3)) // 三字
  }
  
  return [...englishWords, ...chineseNgrams]
}
```

这种方式无需词典，能够处理任意中文文本。

## 搜索特性

### 标题加权

标题匹配的权重是正文的 5 倍：

```typescript
const fieldWeights = {
  title: 5.0,
  content: 1.0
}
```

### 位置加权

- 完全匹配标题：+100 分
- 标题开头匹配：+50 分
- 标题包含匹配：+30 分
- 正文开头匹配：+5 分

### 模糊匹配

当精确匹配结果不足时，启用模糊匹配：

```typescript
function fuzzyMatch(query: string, text: string): boolean {
  const distance = levenshteinDistance(query, text)
  const similarity = 1 - distance / Math.max(query.length, text.length)
  return similarity >= 0.7  // 70% 相似度
}
```

## 使用方式

### 基本搜索

在搜索框中输入关键词，支持：

- 中文关键词
- 英文关键词
- 混合搜索

### 快捷键

- `Ctrl + K` / `Cmd + K` - 聚焦搜索框
- `Enter` - 选择第一个结果
- `Esc` - 清空搜索

## 性能优化

搜索引擎在页面加载时构建索引，后续搜索直接查询内存索引：

- 索引构建：O(n) 时间复杂度
- 搜索查询：O(n) 时间复杂度
- 内存占用：约为原文档大小的 2-3 倍

对于 1000 篇以内的笔记，搜索响应时间通常在 10ms 以内。
